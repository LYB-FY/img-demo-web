# 相似图片分组查看页面

## 功能说明

这个页面用于展示数据库中所有相似的图片分组，支持实时调整相似度阈值并查看结果。

## 页面路由

```
http://localhost:3000/similar-groups
```

## 功能特性

### 1. 相似度阈值调整
- 使用滑块调整相似度阈值（50% - 100%）
- 默认值：90%
- 实时显示当前阈值

### 2. 统计信息展示
- 相似组数：找到的相似图片分组数量
- 相似图片总数：所有组中的图片总数
- 相似度阈值：当前使用的阈值

### 3. 分组展示
- 按组展示相似图片
- 每组显示：
  - 组ID
  - 该组图片数量
  - 所有相似图片的缩略图

### 4. 图片信息
每张图片显示：
- 图片预览（鼠标悬停放大）
- 文件类型标识（PNG/JPG/GIF/WebP）
- 图片ID
- MD5值（前8位）
- 创建时间

## 使用步骤

### 1. 启动后端服务

```bash
cd serves
npm run dev
```

后端服务将运行在 `http://localhost:7001`

### 2. 启动前端服务

```bash
cd demo
npm run dev
```

前端服务将运行在 `http://localhost:3000`

### 3. 访问页面

打开浏览器访问：`http://localhost:3000/similar-groups`

### 4. 使用功能

1. 调整相似度阈值（可选）
2. 点击"🔍 查找相似图片"按钮
3. 等待加载完成
4. 查看分组结果

## API 接口

### 接口地址
```
GET http://localhost:7001/api/image-feature/similar-groups
```

### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| threshold | number | 否 | 0.9 | 相似度阈值（0-1） |

### 响应格式
```json
{
  "success": true,
  "message": "找到 3 组相似图片",
  "data": {
    "groups": [
      {
        "groupId": 1,
        "imageCount": 5,
        "images": [
          {
            "id": "1732345678000001",
            "url": "/img/photo1.jpg",
            "fileType": 2,
            "md5": "abc123def456...",
            "createTime": "2025-11-23T10:30:00.000Z"
          }
        ]
      }
    ],
    "groupCount": 3,
    "totalImages": 15,
    "threshold": 0.9
  }
}
```

## 界面说明

### 控制面板
- 相似度阈值滑块：调整查找的相似度标准
- 查找按钮：开始搜索相似图片

### 统计卡片
显示三个关键指标：
- 相似组数
- 相似图片总数
- 使用的阈值

### 分组列表
- 每个分组用独立的卡片展示
- 卡片内以网格形式排列图片
- 响应式布局，自动适配屏幕大小

### 图片卡片
- 鼠标悬停显示文件类型
- 鼠标悬停图片放大
- 点击可查看详细信息
- 显示图片ID和MD5值

## 注意事项

1. **跨域配置**
   - 前端直接请求后端 API（127.0.0.1:7001）
   - 确保后端已配置 CORS
   - 或者在生产环境配置 Nginx 反向代理

2. **图片路径**
   - 图片URL格式：`http://127.0.0.1:7001/img/xxx.jpg`
   - 确保后端静态文件服务正常

3. **性能优化**
   - 图片使用懒加载（loading="lazy"）
   - 缩略图优化显示
   - 大数据量时可能需要分页

4. **数据要求**
   - 数据库中需要有已计算特征向量的图片
   - 使用 `/api/image-feature/batch-process` 批量处理图片

## 相关页面

- 首页：`/` - 图片相似度校验工具
- 以图搜图：`/image-search` - 上传图片搜索相似图片
- 相似图片分组：`/similar-groups` - 查看所有相似图片分组

## 技术栈

- **前端框架**：Next.js 14 (App Router)
- **语言**：TypeScript
- **样式**：CSS Modules
- **状态管理**：React Hooks (useState)
- **HTTP 请求**：Fetch API

## 文件结构

```
demo/app/similar-groups/
├── page.tsx        # 页面组件
└── styles.css      # 样式文件
```

## 故障排查

### 1. 无法加载数据
- 检查后端服务是否运行
- 检查控制台网络请求
- 验证 API 接口地址是否正确

### 2. 图片无法显示
- 检查图片 URL 是否正确
- 验证后端静态文件服务配置
- 查看浏览器控制台错误信息

### 3. 没有找到相似图片
- 降低相似度阈值
- 确认数据库中有足够的图片数据
- 验证图片特征向量是否已计算

## 未来改进

- [ ] 添加分页功能
- [ ] 支持图片预览弹窗
- [ ] 添加图片下载功能
- [ ] 支持批量删除重复图片
- [ ] 添加图片相似度热力图
- [ ] 支持自定义分组合并/拆分

